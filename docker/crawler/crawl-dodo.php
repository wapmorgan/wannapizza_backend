<?php

$cities = [
    'abakan' => 'Абакан',
    'abinsk' => 'Абинск',
    'adler' => 'Адлер',
    'aksay' => 'Аксай',
    'alexandrov' => 'Александров',
    'almetyevsk' => 'Альметьевск',
    'anapa' => 'Анапа',
    'angarsk' => 'Ангарск',
    'aprelevka' => 'Апрелевка',
    'arzamas' => 'Арзамас',
    'armavir' => 'Армавир',
    'arkhangelsk' => 'Архангельск',
    'astrakhan' => 'Астрахань',
    'achinsk' => 'Ачинск',
    'balakovo' => 'Балаково',
    'balashiha' => 'Балашиха',
    'baltiysk' => 'Балтийск',
    'barabinsk' => 'Барабинск',
    'barnaul' => 'Барнаул (Алтайский край)',
    'bataysk' => 'Батайск',
    'belgorod' => 'Белгород',
    'belogorsk' => 'Белогорск',
    'berdsk' => 'Бердск',
    'berezniki' => 'Березники',
    'blagoveschensk' => 'Благовещенск',
    'bratsk' => 'Братск',
    'bryansk' => 'Брянск',
    'bugulma' => 'Бугульма',
    'buzuluk' => 'Бузулук',
    'velikieluki' => 'Великие Луки',
    'velikiynovgorod' => 'Великий Новгород',
    'velsk' => 'Вельск',
    'vidnoe' => 'Видное',
    'vladivostok' => 'Владивосток',
    'vladikavkaz' => 'Владикавказ',
    'vladimir' => 'Владимир',
    'volgograd' => 'Волгоград',
    'volzhskii' => 'Волжский (Волгоградская обл.)',
    'vologda' => 'Вологда',
    'vorkuta' => 'Воркута',
    'voronezh' => 'Воронеж',
    'voskresensk' => 'Воскресенск',
    'votkinsk' => 'Воткинск',
    'vsevolozhsk' => 'Всеволожск',
    'vyborg' => 'Выборг',
    'vyshnyvolochyok' => 'Вышний Волочек',
    'vyazma' => 'Вязьма',
    'gatchina' => 'Гатчина',
    'gelendzhik' => 'Геленджик',
    'georgiyevsk' => 'Георгиевск',
    'glazov' => 'Глазов',
    'gornoaltaysk' => 'Горно-Алтайск',
    'grozniy' => 'Грозный',
    'gubkin' => 'Губкин',
    'gubkinskiy' => 'Губкинский',
    'dedovsk' => 'Дедовск',
    'dzerzhinsk' => 'Дзержинск',
    'dimitrovgrad' => 'Димитровград',
    'dmitrov' => 'Дмитров',
    'dolgoprudniy' => 'Долгопрудный',
    'domodedovo' => 'Домодедово',
    'drezna' => 'Дрезна',
    'dubna' => 'Дубна',
    'egoryevsk' => 'Егорьевск',
    'yeysk' => 'Ейск',
    'ekaterinburg' => 'Екатеринбург',
    'elabuga' => 'Елабуга',
    'essentuki' => 'Ессентуки',
    'zheleznogorsk' => 'Железногорск (Красноярский край)',
    'zheleznogorskkursk' => 'Железногорск (Курская обл.)',
    'zheldor' => 'Железнодорожный',
    'zhukovsky' => 'Жуковский',
    'zarechniy' => 'Заречный (Пензенская обл.)',
    'zelenogorskspb' => 'Зеленогорск (Санкт-Петербург)',
    'zelenograd' => 'Зеленоград',
    'zelenokumsk' => 'Зеленокумск',
    'zlatoust' => 'Златоуст',
    'ivanovo' => 'Иваново',
    'ivanteevka' => 'Ивантеевка',
    'izhevsk' => 'Ижевск',
    'irkutsk' => 'Иркутск',
    'istra' => 'Истра',
    'yoshkarola' => 'Йошкар-Ола',
    'kazan' => 'Казань',
    'kaliningrad' => 'Калининград',
    'kaluga' => 'Калуга',
    'kamenskuralskiy' => 'Каменск-Уральский',
    'kamenskshakhtinsky' => 'Каменск-Шахтинский',
    'kamyshin' => 'Камышин',
    'kansk' => 'Канск',
    'kashira' => 'Кашира',
    'kemerovo' => 'Кемерово',
    'kingisepp' => 'Кингисепп',
    'kirishi' => 'Кириши',
    'kirov' => 'Киров',
    'kirovsk' => 'Кировск (Лен. область)',
    'kislovodsk' => 'Кисловодск',
    'klimovsk' => 'Климовск',
    'klin' => 'Клин',
    'kovrov' => 'Ковров',
    'kogalym' => 'Когалым',
    'kolomna' => 'Коломна',
    'kolpino' => 'Колпино',
    'kommunarka' => 'Коммунарка',
    'komsomolsknaamure' => 'Комсомольск-на-Амуре',
    'konakovo' => 'Конаково',
    'kopeysk' => 'Копейск',
    'korenovsk' => 'Кореновск',
    'korolev' => 'Королев',
    'korsakov' => 'Корсаков',
    'kostroma' => 'Кострома',
    'kotlas' => 'Котлас',
    'krasnogorsk' => 'Красногорск',
    'krasnodar' => 'Краснодар',
    'krasnoeselo' => 'Красное Село',
    'krasnokamsk' => 'Краснокамск',
    'krasnoobsk' => 'Краснообск',
    'krasnoyarsk' => 'Красноярск',
    'krasnybor' => 'Красный Бор (Ленинградская обл.)',
    'kropotkin' => 'Кропоткин',
    'krymsk' => 'Крымск',
    'kstovo' => 'Кстово',
    'kuvandyk' => 'Кувандык',
    'kudrovo' => 'Кудрово',
    'kuybyshev' => 'Куйбышев',
    'kurgan' => 'Курган',
    'kurovskoye' => 'Куровское',
    'kursk' => 'Курск',
    'labytnangi' => 'Лабытнанги',
    'leninogorsk' => 'Лениногорск',
    'leninskkuznetskiy' => 'Ленинск-Кузнецкий',
    'likinodulyovo' => 'Ликино-Дулёво',
    'lipetsk' => 'Липецк',
    'lobnya' => 'Лобня',
    'lomonosov' => 'Ломоносов',
    'lyubertsy' => 'Люберцы',
    'lyantor' => 'Лянтор',
    'magadan' => 'Магадан',
    'magnitogorsk' => 'Магнитогорск',
    'maikop' => 'Майкоп',
    'mahachkala' => 'Махачкала',
    'miass' => 'Миасс',
    'mineralnyevody' => 'Минеральные Воды',
    'mirnyy' => 'Мирный (Архангельская обл.)',
    'mikhaylovsk' => 'Михайловск',
    'mozhaysk' => 'Можайск',
    'monino' => 'Монино',
    'moscow' => 'Москва',
    'moskovsky' => 'Московский',
    'muravlenko' => 'Муравленко',
    'murino' => 'Мурино',
    'murmansk' => 'Мурманск',
    'murom' => 'Муром',
    'mytishi' => 'Мытищи',
    'naberezhnyechelny' => 'Набережные Челны',
    'nadym' => 'Надым',
    'nalchik' => 'Нальчик',
    'narofominsk' => 'Наро-Фоминск',
    'nahabino' => 'Нахабино',
    'nakhodka' => 'Находка',
    'nevinnomyssk' => 'Невинномысск',
    'neftekamsk' => 'Нефтекамск',
    'nefteyugansk' => 'Нефтеюганск',
    'nizhnevartovsk' => 'Нижневартовск',
    'nizhnekamsk' => 'Нижнекамск',
    'nizhnynovgorod' => 'Нижний Новгород',
    'nizhnytagil' => 'Нижний Тагил',
    'nykolskoe' => 'Никольское',
    'novoaltaysk' => 'Новоалтайск',
    'novokuznetsk' => 'Новокузнецк',
    'novokuibyshevsk' => 'Новокуйбышевск',
    'novomoskovsk' => 'Новомосковск',
    'novorossiysk' => 'Новороссийск',
    'novosibirsk' => 'Новосибирск',
    'novouralsk' => 'Новоуральск',
    'novocheboksarsk' => 'Новочебоксарск',
    'novocherkassk' => 'Новочеркасск',
    'novyurengoy' => 'Новый Уренгой',
    'noginsk' => 'Ногинск',
    'norilsk' => 'Норильск',
    'noyabrsk' => 'Ноябрьск',
    'nyagan' => 'Нягань',
    'obninsk' => 'Обнинск',
    'odintsovo' => 'Одинцово',
    'oktyabrskiy' => 'Октябрьский (респ. Башкортостан)',
    'omsk' => 'Омск',
    'orel' => 'Орел',
    'orenburg' => 'Оренбург',
    'orehovozuevo' => 'Орехово-Зуево',
    'otradnoe' => 'Отрадное (Лен. обл.)',
    'pavlovsk' => 'Павловск',
    'pavlovskiyposad' => 'Павловский Посад',
    'pargolovo' => 'Парголово',
    'penza' => 'Пенза',
    'perm' => 'Пермь',
    'petergof' => 'Петергоф',
    'petrozavodsk' => 'Петрозаводск',
    'petropavlovskkamchatskiy' => 'Петропавловск-Камчатский',
    'podolsk' => 'Подольск',
    'pskov' => 'Псков',
    'pushkino' => 'Пушкино',
    'pyatigorsk' => 'Пятигорск',
    'raduzhnyi' => 'Радужный (Владимирская обл.)',
    'ramenskoe' => 'Раменское',
    'rasskazovka' => 'Рассказовка (Москва)',
    'reutov' => 'Реутов',
    'rzhev' => 'Ржев',
    'rostovnadonu' => 'Ростов-на-Дону',
    'rybinsk' => 'Рыбинск',
    'ryazan' => 'Рязань',
    'salavat' => 'Салават',
    'salehard' => 'Салехард',
    'samara' => 'Самара',
    'peterburg' => 'Санкт-Петербург',
    'saransk' => 'Саранск',
    'sarapul' => 'Сарапул',
    'saratov' => 'Саратов',
    'sarov' => 'Саров',
    'severodvinsk' => 'Северодвинск',
    'seversk' => 'Северск',
    'sergievposad' => 'Сергиев Посад',
    'serov' => 'Серов',
    'serpuhov' => 'Серпухов',
    'sertolovo' => 'Сертолово',
    'sestroretsk' => 'Сестрорецк',
    'skolkovo' => 'Сколково',
    'slavyanka' => 'Славянка',
    'slavyansknakubani' => 'Славянск-на-Кубани',
    'smolensk' => 'Смоленск',
    'sovetskiy' => 'Советский',
    'solnechnogorsk' => 'Солнечногорск',
    'solileck' => 'Соль-Илецк',
    'sosnovybor' => 'Сосновый Бор',
    'sochi' => 'Сочи',
    'stavropol' => 'Ставрополь',
    'starayakupavna' => 'Старая Купавна',
    'stariyoskol' => 'Старый Оскол',
    'sterlitamak' => 'Стерлитамак',
    'strezhevoy' => 'Стрежевой',
    'stupino' => 'Ступино',
    'surgut' => 'Сургут',
    'syzran' => 'Сызрань',
    'syktyvkar' => 'Сыктывкар',
    'taganrog' => 'Таганрог',
    'tambov' => 'Тамбов',
    'tver' => 'Тверь',
    'tikhoretsk' => 'Тихорецк',
    'tobolsk' => 'Тобольск',
    'tolyatti' => 'Тольятти',
    'tomsk' => 'Томск',
    'torzhok' => 'Торжок',
    'tosno' => 'Тосно',
    'troitsk' => 'Троицк (г. Москва)',
    'tuapse' => 'Туапсе',
    'tuymazy' => 'Туймазы',
    'tula' => 'Тула',
    'tyumen' => 'Тюмень',
    'ulanude' => 'Улан-Удэ',
    'ulyanovka' => 'Ульяновка',
    'ulyanovsk' => 'Ульяновск',
    'usinsk' => 'Усинск',
    'usolyesibirskoe' => 'Усолье-Сибирское',
    'ussuriisk' => 'Уссурийск',
    'ufa' => 'Уфа',
    'uhta' => 'Ухта',
    'fryazino' => 'Фрязино',
    'khabarovsk' => 'Хабаровск',
    'khantymansiysk' => 'Ханты-Мансийск',
    'khimki' => 'Химки',
    'khotkovo' => 'Хотьково',
    'tchaikovsky' => 'Чайковский',
    'chapaevsk' => 'Чапаевск',
    'cheboksari' => 'Чебоксары',
    'chelyabinsk' => 'Челябинск',
    'cherepovets' => 'Череповец',
    'chehov' => 'Чехов',
    'chita' => 'Чита',
    'shatura' => 'Шатура',
    'shahty' => 'Шахты',
    'shlisselburg' => 'Шлиссельбург',
    'shushary' => 'Шушары',
    'shelkovo' => 'Щелково',
    'scherbinka' => 'Щербинка',
    'elektrostal' => 'Электросталь',
    'engels' => 'Энгельс',
    'yugorsk' => 'Югорск',
    'yuzhnosakhalinsk' => 'Южно-Сахалинск',
    'yablonovskiy' => 'Яблоновский',
    'yakutsk' => 'Якутск',
    'yaroslavl' => 'Ярославль',
];

function downloadMenu($city)
{
    $url = 'https://dodopizza.ru/' . $city;

    echo 'Downloading "'.$city.'" ...';
    $time = microtime(true);
    $content = file_get_contents($url);
    echo ' got in ' . round(microtime(true) - $time, 3) . PHP_EOL;

    preg_match_all('~JSON\.parse\("(.*)"\)\;window~us', $content, $match);
    $json_string = str_replace('\u0022', '"', $match[1][0]);
    $size = strlen($json_string);
    //$file = getenv('CRAWLER_DATA_DIR').'/dodo.'.$city.'.json';
    $file = '/var/crawler/data/dodo.' . $city . '.json';

    echo 'Saving ' . $size . ' byte(s) to ' . $file . ' ...';
    $written = file_put_contents($file, $json_string);

    echo ' written ' . $written . PHP_EOL;

    if ($written !== $size) {
        throw new \RuntimeException();
    }
}

foreach ($cities as $city => $city_label) {
    downloadMenu($city);
    sleep(15);
}

return 0;
